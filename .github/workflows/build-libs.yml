name: Build whisper.cpp libs

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build:
    strategy:
      matrix:
        # macos-arm64, macos-x86_64, linux-x86_64, linux-arm64
        runner: [macos-14, macos-13, ubuntu-24.04, ubuntu-24.04-arm]
    runs-on: ${{ matrix.runner }}
    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v5
      - name: Install Vulkan deps
        if: runner.os == 'Linux'
        run: sudo apt-get update -qq && sudo apt-get install -y -qq libvulkan-dev glslang-tools glslc libshaderc-dev
      - name: Build and upload
        env:
          GH_TOKEN: ${{ github.token }}
        run: uv run scripts/build-libs.py --upload
